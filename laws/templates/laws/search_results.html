{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <!-- Assuming 'query' is passed in the context from the view -->
    <h1 class="mb-4 text-2xl font-bold text-gray-800">Search Results for "<span class="text-blue-600">{{ query }}</span>"</h1>

    {% if results %}
        <p class="text-lg text-gray-600 mb-6">Found {{ results|length }} matching documents.</p>

        {% for result in results %}
        <div class="bg-white p-5 rounded-xl shadow-md mb-4 border-l-4 border-blue-500 hover:shadow-lg transition duration-200">
            <div class="mb-2">
                <!-- 1. The Law Title (Standardized across all result types) -->
                <h3 class="text-xl font-semibold text-blue-700">
                    {{ result.law_title|default_if_none:"[Law Title Missing]"|safe }}
                </h3>
            </div>
            
            <!-- --- DOCUMENT TYPE SPECIFIC DISPLAY LOGIC --- -->
            
            {% if result.result_type == 'Section' %}
    <div class="result-snippet mt-2">
        <p class="text-lg font-medium">

            {% if result.law_slug %}
                <a href="{% url 'law_detail' result.law_slug %}#{{ result.anchor_tag }}" 
                   class="text-gray-900 hover:text-blue-600 transition duration-150">
            {% else %}
                <a href="#" 
                   class="text-gray-400 cursor-not-allowed" 
                   title="Missing law slug">
            {% endif %}
                    <strong>
                        {% if result.highlight.part_heading %}
                            {{ result.highlight.part_heading|safe }}<br>
                        {% endif %}
                        {% if result.highlight.chapter_heading %}
                            {{ result.highlight.chapter_heading|safe }}<br>
                        {% endif %}
                        S.{{ result.highlight.section_number|default_if_none:"N/A"|safe }}
                        - {{ result.highlight.section_title|default_if_none:"[No Section Title]"|safe }}
                    </strong>
                </a>
        </p>

        <p class="mt-1 text-sm text-gray-700">
            {{ result.highlight.content|safe }}
        </p>
    </div>
{% endif %}


            {% elif result.result_type == 'Schedule' %}
                <!-- Schedule Snippet and Link -->
                <div class="result-snippet mt-2">
                    <p class="text-lg font-medium">
                        <!-- OPTIMIZED LINK -->
                        <a href="{% url 'law_detail' result.law_slug %}#{{ result.anchor_tag }}" class="text-gray-900 hover:text-blue-600 transition duration-150">
                            <strong>
                                Schedule {{ result.schedule_number|default_if_none:"[Number N/A]"|safe }} - {{ result.title|default_if_none:"[No Schedule Title]"|safe }}
                            </strong>
                        </a>
                    </p>
                    <p class="mt-1 text-sm text-gray-700">{{ result.highlight.content|safe }}</p>
                </div>
                <p class="mt-2 text-xs text-gray-500">
                    Type: Schedule | Anchor: <span class="font-mono text-gray-600">{{ result.anchor_tag }}</span>
                </p>

            {% elif result.result_type == 'Appendix' %}
                <!-- Appendix Snippet and Link -->
                <div class="result-snippet mt-2">
                    <p class="text-lg font-medium">
                        <!-- OPTIMIZED LINK -->
                        <a href="{% url 'law_detail' result.law_slug %}#{{ result.anchor_tag }}" class="text-gray-900 hover:text-blue-600 transition duration-150">
                            <strong>
                                Appendix {{ result.appendix_number|default_if_none:"[Number N/A]"|safe }} - {{ result.title|default_if_none:"[No Appendix Title]"|safe }}
                            </strong>
                        </a>
                    </p>
                    <p class="mt-1 text-sm text-gray-700">{{ result.highlight.content|safe }}</p>
                </div>
                <p class="mt-2 text-xs text-gray-500">
                    Type: Appendix | Anchor: <span class="font-mono text-gray-600">{{ result.anchor_tag }}</span>
                </p>

            {% else %}
                <p class="text-red-500 font-bold">Error: Unknown document type or indexing failure.</p>
            {% endif %}

        </div>
        {% endfor %}

    {% else %}
        <div class="p-6 bg-yellow-50 border border-yellow-300 rounded-xl text-yellow-800">
            <h4 class="text-xl font-semibold mb-2">No Results Found</h4>
            <p>We couldn't find any law documents matching your query: <strong>"{{ query }}"</strong>.</p>
            <p class="mt-3">Try simplifying your search terms or checking your spelling.</p>
        </div>
    {% endif %}

</div>
{% endblock content %}